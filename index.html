<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cuestionario ‚Äî Manipulaci√≥n de Alimentos</title>
<style>
  :root{
    --ink:#0b1220; --muted:#475569; --bg:#eef2f8; --card:#ffffff; --line:#e5e7eb;
    --ok:#10b981; --bad:#ef4444; --brand:#111827; --accent:#0ea5e9;
    --grad1:#2a3147; --grad2:#1e2436;
  }
  *{box-sizing:border-box}
  body{
    margin:0; color:var(--ink); font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Arial,sans-serif;
    background:
      radial-gradient(1200px 600px at -10% -10%, #cdd7f1 0, rgba(255,255,255,0) 60%),
      radial-gradient(1000px 600px at 110% -10%, #cfe7ff 0, rgba(255,255,255,0) 55%),
      linear-gradient(180deg, var(--grad1) 0, var(--grad2) 160px, #f4f6fb 160px);
  }
  .wrap{max-width:1024px;margin:0 auto;padding:26px; padding-top:32px;}

  /* Topbar fija (s√≥lida y legible) */
  .topbar{
    position:sticky; top:0; z-index:50;
    background:#ffffff;
    color:#0b1220;
    padding:12px 18px;
    border-bottom:1px solid #e5e7eb;
    box-shadow:0 6px 16px rgba(15,23,42,.08);
  }
  .topbar .title{font-weight:900; font-size:clamp(22px,3vw,34px); letter-spacing:.2px}
  .topbar .sub{color:#64748b}
  .topbar .row{display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap}
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    background:#f8fafc; border:1px solid #e5e7eb;
    padding:8px 12px; border-radius:999px; color:#0f172a; font-weight:700
  }
  .dot{width:10px;height:10px;border-radius:999px;display:inline-block}
  .dot.g{background:#22c55e}.dot.y{background:#f59e0b}.dot.r{background:#ef4444}

  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 12px 28px rgba(15,23,42,.08)}
  .shell{padding:18px}

  /* Portada */
  .logos{display:flex;gap:18px;justify-content:space-between;align-items:center;flex-wrap:wrap}
  .logo{background:#f6f8fc;border:1px solid var(--line);border-radius:14px;padding:12px 16px;flex:1;display:flex;justify-content:center}
  .logo img{height:140px;max-width:100%;object-fit:contain}
  .info{background:#f3f6ff;border:1px solid #d7e4ff;border-radius:14px;padding:14px 16px;margin-top:14px}
  .levels{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:16px}
  .lvl{background:#f9fbff;border:1px solid var(--line);border-radius:14px;padding:16px;text-align:center}
  .lvl .meta{color:var(--muted);font-size:14px}
  .btn{background:var(--brand);color:#fff;border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
  .ghost{background:#0a66cc}

  /* Quiz */
  .quiz-head{display:flex; align-items:center; gap:12px; flex-wrap:wrap}
  .stat{display:inline-flex; align-items:center; gap:6px; padding:8px 10px; border-radius:999px; background:#f3f4f6; border:1px solid var(--line); font-weight:700}
  .stat.ok{background:#ecfdf5; border-color:#bbf7d0; color:#065f46}
  .stat.bad{background:#fef2f2; border-color:#fecaca; color:#7f1d1d}
  .qtitle{font-weight:800;margin:10px 0 6px}
  .choices{display:grid;gap:10px;margin-top:8px}
  .choice{background:#ffffff;border:1px solid var(--line);border-radius:12px;padding:12px;cursor:pointer}
  .choice:hover{box-shadow:0 10px 20px rgba(15,23,42,.05)}
  .choice.correct{border-color:var(--ok);background:#ecfdf5}
  .choice.incorrect{border-color:var(--bad);background:#fef2f2}
  .explain{margin-top:10px;background:#f7fafc;border:1px solid var(--line);border-radius:12px;padding:10px}
  .footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
  .btn:disabled{opacity:.5;cursor:not-allowed}

  /* Barra de progreso */
  .progress{height:12px;background:#eef2f7;border:1px solid var(--line);border-radius:999px;overflow:hidden}
  .bar{height:100%;width:0;background:linear-gradient(90deg,#22c55e,#0ea5e9);transition:width .25s ease}

  /* Ranking modal (sin borrar) */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:20px;background:rgba(0,0,0,.25)}
  .modal.show{display:flex}
  .panel{max-width:620px;width:100%;background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:0 18px 40px rgba(15,23,42,.18)}
  .panel .shell{padding:16px}
  .rank{font-size:15px;line-height:1.55}

  @media (max-width:900px){.levels{grid-template-columns:1fr}.logo img{height:120px}}
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="row">
    <div>
      <div class="title">Cuestionario ‚Äî Manipulaci√≥n de Alimentos</div>
      <div class="sub">Elige bloque: 1 = f√°cil ¬∑ 2 = medio ¬∑ 3 = dif√≠cil.</div>
    </div>
    <div class="pill" id="topStatus" aria-live="polite">En portada</div>
  </div>
</div>

<div class="wrap">

  <!-- PORTADA -->
  <div id="home" class="card">
    <div class="shell">
      <div class="logos">
        <div class="logo"><img src="img/guadiana-logo.jpg" alt="Hotel Guadiana"></div>
        <div class="logo"><img src="img/cumbria-logo.jpg" alt="Hotel Cumbria"></div>
      </div>

      <div class="info">
        <b>¬øPor qu√© realizamos este cuestionario en nuestros hoteles?</b>
        <ul>
          <li>Prevenir intoxicaciones y alergias alimentarias (al√©rgenos, anisakis, temperaturas).</li>
          <li>Cumplir la normativa vigente y los est√°ndares de calidad a los que aspiramos.</li>
          <li>Mejorar la experiencia del cliente asegurando alimentos seguros en todo momento.</li>
          <li>Reducir mermas y reprocesos mediante buenas pr√°cticas (FIFO/FEFO, limpieza y desinfecci√≥n).</li>
          <li>Fortalecer la cultura de seguridad alimentaria en todos los turnos y departamentos.</li>
        </ul>
      </div>

      <div class="levels">
        <div class="lvl">
          <div class="meta">BLOQUE 1 ¬∑ F√ÅCIL</div>
          <h3><span class="dot g"></span> Nivel 1</h3>
          <div class="meta">25 preguntas cargadas ¬∑ objetivo 25</div>
          <div style="margin-top:10px"><button class="btn" onclick="startBlock('1')">Empezar ‚Üí</button></div>
        </div>
        <div class="lvl">
          <div class="meta">BLOQUE 2 ¬∑ MEDIO</div>
          <h3><span class="dot y"></span> Nivel 2</h3>
          <div class="meta">25 preguntas cargadas ¬∑ objetivo 25</div>
          <div style="margin-top:10px"><button class="btn" onclick="startBlock('2')">Empezar ‚Üí</button></div>
        </div>
        <div class="lvl">
          <div class="meta">BLOQUE 3 ¬∑ DIF√çCIL</div>
          <h3><span class="dot r"></span> Nivel 3</h3>
          <div class="meta">25 preguntas cargadas ¬∑ objetivo 25</div>
          <div style="margin-top:10px"><button class="btn" onclick="startBlock('3')">Empezar ‚Üí</button></div>
        </div>
      </div>

      <div style="margin-top:14px;display:flex;gap:10px">
        <button class="btn ghost" onclick="openRanking()">Ver ranking</button>
      </div>

      <p class="meta" style="margin-top:10px">Recomendaci√≥n: completar los 3 bloques. No se puede retroceder entre preguntas.</p>
    </div>
  </div>

  <!-- QUIZ -->
  <div id="quiz" class="card" style="display:none;margin-top:16px">
    <div class="shell">
      <div class="quiz-head">
        <div id="head" class="pill" style="background:#eef2ff;border:1px solid #dbe4ff;color:#1e293b">Bloque</div>
        <div class="stat ok">‚úÖ Aciertos: <span id="statOk">0</span></div>
        <div class="stat bad">‚ùå Fallos: <span id="statBad">0</span></div>
        <div class="stat">üìÑ Pregunta: <span id="statQ">0</span>/<span id="statTotal">0</span></div>
      </div>

      <div style="margin:10px 0">
        <div class="progress" aria-label="Progreso del cuestionario">
          <div id="bar" class="bar"></div>
        </div>
      </div>

      <div id="qtitle" class="qtitle"></div>
      <div id="choices" class="choices"></div>
      <div id="explain" class="explain" style="display:none"></div>
      <div class="footer">
        <div class="meta" id="progressText"></div>
        <button id="next" class="btn" disabled>Siguiente</button>
      </div>
    </div>
  </div>

  <!-- RESULTADO -->
  <div id="end" class="card" style="display:none;margin-top:16px">
    <div class="shell">
      <h2>Bloque completado</h2>
      <p id="score"></p>
      <div id="review"></div>
      <p id="recommendation" class="meta"></p>
      <div style="margin-top:10px">
        <button class="btn ghost" onclick="openRanking()">Ver ranking</button>
        <button class="btn" style="background:#334155" onclick="showStart()">Volver al inicio</button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL RANKING (sin borrar) -->
<div id="rankModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="rankTitle">
  <div class="panel">
    <div class="shell">
      <h3 id="rankTitle">Ranking</h3>
      <div class="rank" id="rankList">A√∫n no hay puntuaciones.</div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button class="btn ghost" onclick="closeRanking()">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ===== OPCIONAL: URL de tu Worker/endpoint si quieres guardar en GitHub ===== */
var ENDPOINT_URL = ""; // d√©jalo vac√≠o si no lo usas

/* ===== 3 BLOQUES √ó 25 PREGUNTAS ===== */
var BLOCKS = {
"1":{"id":1,"level":"F√°cil","questions":[
{"q":"¬øQu√© es la contaminaci√≥n cruzada?","options":["Cuando un alimento pierde sabor por el fr√≠o.","La transferencia de microorganismos o al√©rgenos entre alimentos por contacto directo o indirecto.","La mezcla voluntaria de dos alimentos compatibles."],"correctIndex":1,"rationale":"Puede producirse por manos, utensilios, pa√±os o superficies; separa crudos de listos para consumo."},
{"q":"Temperatura correcta de refrigeraci√≥n para alimentos frescos en general:","options":["0‚Äì4 ¬∞C","10‚Äì14 ¬∞C","‚Äì5‚Äì0 ¬∞C"],"correctIndex":0,"rationale":"La proliferaci√≥n microbiana se ralentiza a 0‚Äì4 ¬∞C; vigila con term√≥metro."},
{"q":"¬øSe pueden descongelar alimentos a temperatura ambiente?","options":["S√≠, si se cocinan luego.","No, deben descongelarse en nevera o microondas.","S√≠, si se cubren con film."],"correctIndex":1,"rationale":"La descongelaci√≥n a temperatura ambiente favorece el crecimiento microbiano superficial."},
{"q":"Temperatura m√≠nima en el centro del producto para una cocci√≥n segura general:","options":["55 ¬∞C","70 ¬∞C","90 ¬∞C"],"correctIndex":1,"rationale":"70 ¬∞C en el centro es referencia de seguridad; huevo fresco en tortilla requiere 75 ¬∞C."},
{"q":"Uso de guantes:","options":["Sustituyen el lavado de manos.","No eximen del lavado y deben cambiarse con frecuencia.","Pueden usarse todo el d√≠a."],"correctIndex":1,"rationale":"Los guantes no sustituyen la higiene de manos; c√°mbialos al cambiar de tarea."},
{"q":"Orden en frigor√≠fico √∫nico para evitar contaminaci√≥n cruzada:","options":["Crudos arriba y cocinados abajo.","Cocinados arriba y crudos abajo.","Todo mezclado si est√° tapado."],"correctIndex":1,"rationale":"Coloca cocinados arriba para evitar goteos de crudos sobre alimentos listos para consumo."},
{"q":"Mantenimiento en caliente antes del servicio (m√≠nimo en el centro del alimento):","options":["45 ¬∞C","65 ¬∞C","80 ¬∞C"],"correctIndex":1,"rationale":"Mantener a ‚â•65 ¬∞C reduce el riesgo de crecimiento microbiano."},
{"q":"¬øCu√°ndo debes lavarte las manos?","options":["Solo al empezar el turno.","Antes de manipular alimentos y tras tocar crudos, basura, m√≥vil, toser, ir al ba√±o, etc.","Cada hora."],"correctIndex":1,"rationale":"Siempre que se cambie de tarea o haya posibilidad de contaminaci√≥n."},
{"q":"¬øSe pueden volver a congelar alimentos ya descongelados?","options":["S√≠, siempre.","No, nunca.","Solo si no han perdido el vac√≠o."],"correctIndex":1,"rationale":"No recongelar: aumenta el riesgo de proliferaci√≥n y deterioro."},
{"q":"¬øQu√© no debes hacer al manipular alimentos?","options":["Usar pa√±os de cocina para m√∫ltiples tareas.","Probar con cuchara limpia y lavarla despu√©s.","Usar utensilios para tocar alimentos listos."],"correctIndex":0,"rationale":"Evita pa√±os reutilizados; mejor papel desechable y pa√±os diferenciados."},
{"q":"Lavado de frutas/verduras crudas:","options":["No es necesario si se ven limpias.","Lavar enteras bajo el grifo y desinfectar seg√∫n protocolo.","Cortar primero y luego lavar."],"correctIndex":1,"rationale":"Lavar la pieza entera primero evita que la suciedad entre en el interior."},
{"q":"Para reducir anisakis en pescado crudo/marinado:","options":["Solo lavarlo con agua fr√≠a.","Congelar a ‚Äì20 ¬∞C ‚â•24 h antes del servicio.","Cocinarlos a 50 ¬∞C."],"correctIndex":1,"rationale":"La congelaci√≥n a ‚Äì20 ¬∞C durante al menos 24 h inactiva anisakis."},
{"q":"Conservaci√≥n de platos elaborados para >24 h:","options":["0‚Äì4 ¬∞C","0‚Äì8 ¬∞C","5‚Äì8 ¬∞C"],"correctIndex":0,"rationale":"Para duraciones largas, 0‚Äì4 ¬∞C; si <24 h, hasta 8 ¬∞C."},
{"q":"Gesti√≥n de residuos:","options":["Abrir contenedores con pedal y limpiarlos a diario.","Vaciar solo al 100% y abrir con la mano.","Verter aceite usado por el fregadero."],"correctIndex":0,"rationale":"Evita contacto manual y vierte aceites en gestores autorizados."},
{"q":"Higiene personal correcta:","options":["Usar joyas si est√°n limpias.","U√±as cortas, sin esmalte; cabello recogido y cubierto.","Perfume intenso para tapar olores."],"correctIndex":1,"rationale":"Las joyas y esmaltes pueden desprenderse/contaminar; el cabello debe estar controlado."},
{"q":"Equipamiento de corte (tablas y cuchillos):","options":["Usar la misma tabla para todo.","Diferenciar por c√≥digo de color o uso.","Solo importa que est√©n afilados."],"correctIndex":1,"rationale":"Separar tablas por uso reduce contaminaci√≥n cruzada."},
{"q":"Limpieza de superficies:","options":["Primero desinfectar y luego limpiar.","Primero limpiar con detergente, despu√©s desinfectar.","Solo agua caliente."],"correctIndex":1,"rationale":"La materia org√°nica inactiva desinfectantes; limpia antes de desinfectar."},
{"q":"Cadena de fr√≠o en recepci√≥n:","options":["No es importante si el transporte fue corto.","Registrar temperaturas y almacenar de inmediato.","Esperar a terminar otras tareas."],"correctIndex":1,"rationale":"Las temperaturas deben verificarse y los productos entrar a c√°mara sin demora."},
{"q":"Fecha de caducidad vs. consumo preferente:","options":["Son lo mismo.","Caducidad: seguridad; Preferente: calidad.","Preferente es m√°s estricta que caducidad."],"correctIndex":1,"rationale":"La caducidad implica riesgo sanitario tras la fecha; consumo preferente afecta cualidades organol√©pticas."},
{"q":"Descongelaci√≥n segura de grandes piezas:","options":["En nevera, sobre rejilla, recipientes que recojan goteos.","A temperatura ambiente sobre la mesa.","Bajo agua caliente."],"correctIndex":0,"rationale":"Evita goteos y superficies a temperatura de peligro."},
{"q":"Toma de temperatura del alimento:","options":["Cualquier zona sirve.","En el centro del producto y zonas m√°s gruesas.","En la superficie."],"correctIndex":1,"rationale":"El punto m√°s fr√≠o suele ser el centro; verifica all√≠."},
{"q":"Uso del m√≥vil en cocina:","options":["Permitido si es r√°pido.","Evitarlo; si se usa, lavar manos despu√©s.","No influye."],"correctIndex":1,"rationale":"El m√≥vil es un vector de contaminaci√≥n; higiene posterior obligatoria."},
{"q":"Desinfecci√≥n de hojas verdes:","options":["Jab√≥n suave.","Agua con desinfectante alimentario seg√∫n etiqueta.","Vinagre casero siempre."],"correctIndex":1,"rationale":"Usa productos autorizados y respeta tiempos/concentraciones."},
{"q":"Manipulaci√≥n de hielo para bebidas:","options":["Con las manos limpias.","Con pinzas o cubitera y utensilios limpios.","Cualquier m√©todo sirve."],"correctIndex":1,"rationale":"El hielo es alimento; manip√∫lalo con utensilios limpios para evitar contaminaci√≥n."},
{"q":"Al√©rgenos:","options":["Basta con avisar verbalmente.","Debes conocer y poder informar por escrito de los al√©rgenos presentes.","No es obligatorio informar."],"correctIndex":1,"rationale":"La informaci√≥n de al√©rgenos debe ser clara, accesible y fiable para el cliente."}
]},
"2":{"id":2,"level":"Medio","questions":[
{"q":"Zona de peligro de temperaturas para crecimiento microbiano (aprox.):","options":["10‚Äì64 ¬∞C","‚Äì18‚Äì0 ¬∞C","65‚Äì90 ¬∞C"],"correctIndex":0,"rationale":"Evita mantener alimentos en ese rango durante tiempos prolongados."},
{"q":"Huevos en elaboraciones (p. ej., tortillas): temperatura de seguridad en el centro:","options":["60 ¬∞C","70 ¬∞C","75 ¬∞C"],"correctIndex":2,"rationale":"Para huevo fresco en tortilla se recomienda alcanzar 75 ¬∞C en centro."},
{"q":"Recepci√≥n de congelados:","options":["‚Äì18 ¬∞C (¬±3 ¬∞C) y envases √≠ntegros.","0‚Äì4 ¬∞C y envases abiertos.","Cualquier temperatura si se ven duros."],"correctIndex":0,"rationale":"Comprueba temperatura y estado del envase; rechazo si no cumple."},
{"q":"Verduras para consumo en crudo:","options":["Cortar primero y luego lavar.","Lavar enteras, desinfectar y enjuagar.","No requieren desinfecci√≥n."],"correctIndex":1,"rationale":"Lavar enteras evita arrastrar suciedad al interior."},
{"q":"Aceites de fritura: cu√°ndo renovar:","options":["Con humo, viscosidad, oscurecimiento o espuma.","Una vez por semana siempre.","Solo si cambia el sabor."],"correctIndex":0,"rationale":"Esos signos indican degradaci√≥n y compuestos indeseables."},
{"q":"Alergia vs. intolerancia:","options":["Ambas son inmunitarias.","La intolerancia es siempre m√°s grave.","Alergia es inmunitaria; intolerancia es dificultad de digesti√≥n/metabolismo."],"correctIndex":2,"rationale":"Diferenciar ambas para informar y etiquetar correctamente."},
{"q":"Anisakis en pescado a consumir crudo/marinado:","options":["Congelar a ‚Äì20 ¬∞C ‚â•24 h.","Solo lavar con agua fr√≠a.","No requiere nada si es del d√≠a."],"correctIndex":0,"rationale":"La congelaci√≥n preventiva es obligada salvo exenciones espec√≠ficas."},
{"q":"Mantenimiento en fr√≠o de elaboraciones >24 h:","options":["0‚Äì4 ¬∞C","0‚Äì8 ¬∞C","5‚Äì8 ¬∞C"],"correctIndex":0,"rationale":"Para periodos largos, m√°ximo 4 ¬∞C."},
{"q":"Gesti√≥n de residuos correcta:","options":["Tapa con pedal, limpieza y vaciado frecuente.","Abrir con la mano y vaciar al 100%.","Aceite por el desag√ºe con agua caliente."],"correctIndex":0,"rationale":"Evita vectores y atascos; gestor autorizado para aceites."},
{"q":"Envasado al vac√≠o tras elaboraci√≥n:","options":["Conservar a ‚â§4 ¬∞C e identificar con fecha y lote.","Puede ir a ambiente si el cierre es bueno.","Reutilizar envases qu√≠micos si se lavan."],"correctIndex":0,"rationale":"El vac√≠o no sustituye el fr√≠o; trazabilidad imprescindible."},
{"q":"Plan de limpieza y desinfecci√≥n (PLD):","options":["Improvisar seg√∫n suciedad.","Debe estar documentado con qu√©, c√≥mo, cu√°ndo y qui√©n.","Solo limpiar cuando venga inspecci√≥n."],"correctIndex":1,"rationale":"Procedimientos escritos y registros garantizan control higi√©nico."},
{"q":"Control de plagas (DDD):","options":["Dejar residuos de comida para atraer cebo.","Mantener orden/limpieza y contratar servicio autorizado con registros.","Solo usar insecticida dom√©stico."],"correctIndex":1,"rationale":"Prevenci√≥n + monitoreo profesional con trazabilidad."},
{"q":"Trazabilidad:","options":["Conservar albaranes/etiquetas y poder rastrear lotes.","No es necesaria si compro a diario.","Solo aplica a carne y pescado."],"correctIndex":0,"rationale":"Permite identificar y retirar productos en caso de alerta."},
{"q":"Enfriamiento r√°pido de platos cocinados:","options":["De caliente a ‚â§8 ¬∞C en <2 h; usar abatidor o porcionar.","Esperar a que se temple a ambiente.","Tapar caliente y a c√°mara inmediatamente."],"correctIndex":0,"rationale":"Cruzar la zona de peligro lo m√°s r√°pido posible."},
{"q":"Almacenamiento en seco (despensa):","options":["10‚Äì21 ¬∞C, seco, limpio y ventilado; rotaci√≥n FIFO/FEFO.","Cualquier temperatura si est√° cerrado.","Junto a productos qu√≠micos si est√°n precintados."],"correctIndex":0,"rationale":"Control ambiental y separaci√≥n de qu√≠micos es esencial."},
{"q":"Manipulador con s√≠ntomas gastrointestinales:","options":["Puede trabajar en sala.","Debe comunicar y abandonar tareas de alimentos; valoraci√≥n m√©dica.","Solo usar doble guante."],"correctIndex":1,"rationale":"Evitar el riesgo de transmisi√≥n por manos o got√≠culas."},
{"q":"Uso de pa√±os:","options":["Reutilizar continuamente.","Pa√±os diferenciados por uso o, mejor, papel desechable.","Cualquiera sirve."],"correctIndex":1,"rationale":"Reduce contaminaci√≥n cruzada entre zonas/tareas."},
{"q":"Descongelaci√≥n en microondas:","options":["Permitida, seguido de cocci√≥n inmediata.","Prohibida.","Solo para pan."],"correctIndex":0,"rationale":"Descongelar y cocinar sin demora evita proliferaci√≥n."},
{"q":"Huevos con c√°scara sucia o rota:","options":["Usarlos si se lavan bien.","No deben usarse en cocina; riesgo de contaminaci√≥n.","Solo para bizcochos."],"correctIndex":1,"rationale":"La c√°scara da√±ada facilita entrada de microorganismos."},
{"q":"Cuchillos y tablas tras tocar crudo:","options":["Seguir con listo para consumo.","Lavar y desinfectar antes de cambiar de alimento.","Limpiar con servilleta."],"correctIndex":1,"rationale":"Evita transferencia de pat√≥genos a alimentos listos."},
{"q":"Mantenimiento en caliente en autoservicio/buffet:","options":["‚â•65 ¬∞C y control frecuente.","50‚Äì60 ¬∞C suficientes.","Cualquier temperatura si hay tapa."],"correctIndex":0,"rationale":"La l√≠nea caliente exige control para evitar zona de peligro."},
{"q":"Recalentamiento de platos preparados:","options":["Alcanzar 70 ¬∞C en el centro en corto tiempo con equipo adecuado.","Al ba√±o mar√≠a lento hasta templado.","Solo que humee."],"correctIndex":0,"rationale":"Recalentar r√°pido hasta temperatura segura; no usar equipos lentos para elevar temperatura."},
{"q":"Hielo almacenado junto a pescado crudo:","options":["Admite contacto directo.","Separar y manipular con utensilios distintos.","No importa si el hielo se ve limpio."],"correctIndex":1,"rationale":"Evita contaminaci√≥n por goteos y contacto crudo-listo."},
{"q":"Etiquetado interno de elaboraciones:","options":["Fecha de elaboraci√≥n, caducidad/consumo, lote y responsable.","No hace falta si es para hoy.","Solo el nombre del plato."],"correctIndex":0,"rationale":"Facilita control de rotaci√≥n, trazabilidad y responsabilidades."},
{"q":"Agua no potable por aver√≠a:","options":["Seguir operando igual.","Suspender preparaciones que requieran agua potable y usar agua segura embotellada; informar.","Hervir 1 minuto basta para todo."],"correctIndex":1,"rationale":"Sin agua potable, limitar operaciones o usar fuentes seguras verificadas."}
]},
"3":{"id":3,"level":"Dif√≠cil","questions":[
{"q":"Recepci√≥n: latas abolladas o hinchadas:","options":["Aceptar si el contenido huele bien.","Rechazar por posible contaminaci√≥n/deterioro.","Abrir y cocinar de inmediato."],"correctIndex":1,"rationale":"Envases alterados son criterio de rechazo por riesgo f√≠sico/qu√≠mico/biol√≥gico."},
{"q":"Recalentar platos preparados de forma segura:","options":["Alcanzar 70 ¬∞C en el centro en menos de 1 hora con equipo adecuado.","Cualquier temperatura si se mantiene al ba√±o mar√≠a.","60 ¬∞C basta si la salsa hierve."],"correctIndex":0,"rationale":"Recalentamiento r√°pido hasta 70 ¬∞C; no usar equipos lentos como elevadores de temperatura."},
{"q":"Riesgo de acrilamida/PAH:","options":["Asociado a cocciones muy tostadas/quemadas en alimentos ricos en almid√≥n.","Solo en frituras de pescado.","Sin relevancia sanitaria."],"correctIndex":0,"rationale":"Evita tonalidades muy oscuras en patatas, pan y rebozados."},
{"q":"Clasificaci√≥n de peligro: fragmento de cristal en un plato:","options":["Qu√≠mico","F√≠sico","Biol√≥gico"],"correctIndex":1,"rationale":"Se trata de un peligro f√≠sico (cuerpo extra√±o)."},
{"q":"Control de equipos de fr√≠o:","options":["Sobrecargar c√°maras para optimizar espacio.","Registrar temperaturas y permitir circulaci√≥n de aire.","Mantener puertas abiertas en preparaciones largas."],"correctIndex":1,"rationale":"No sobrecargar; registra temperaturas y deja espacio para el aire."},
{"q":"Herida en la mano del manipulador/a:","options":["Trabajar normal si es peque√±a.","Desinfectar, cubrir con ap√≥sito impermeable visible y usar guante; informar.","Solo lavarse."],"correctIndex":1,"rationale":"Las heridas son foco de contaminaci√≥n; proteger y valorar aptitud."},
{"q":"Separaci√≥n en almacenamiento (una c√°mara):","options":["Pescados crudos arriba.","Cocinados arriba; crudos abajo; evitar cartones dentro.","Verduras crudas sobre cocinados para frescor."],"correctIndex":1,"rationale":"Evita goteos de crudos sobre listos; reduce materiales porosos dentro de c√°mara."},
{"q":"Enfriamiento r√°pido de platos cocinados:","options":["A ‚â§8 ¬∞C en <2 h; abatidor o porciones peque√±as.","Esperar a ambiente hasta templado.","Tapar caliente y guardar en c√°mara."],"correctIndex":0,"rationale":"Cruza la zona de peligro lo antes posible."},
{"q":"Conductas personales adecuadas:","options":["Peinarse en cocina con cofia.","Evitar tocarse la cara; toser/estornudar en pa√±uelo desechable y lavarse manos despu√©s.","Usar el mismo pa√±o para manos y encimera."],"correctIndex":1,"rationale":"Minimiza transferencias de microorganismos."},
{"q":"Descongelaci√≥n de mariscos grandes:","options":["En nevera sobre rejilla y bandeja para goteos; tiempo planificado.","A temperatura ambiente por rapidez.","Bajo agua caliente para acelerar."],"correctIndex":0,"rationale":"Evita zona de peligro y contaminaci√≥n de superficies."},
{"q":"Gesti√≥n de al√©rgenos en cocina:","options":["Producir todos los platos en la misma zona.","Separar preparaci√≥n, utensilios y almacenamiento; limpiar y etiquetar correctamente.","Solo avisar verbalmente al cliente."],"correctIndex":1,"rationale":"La separaci√≥n f√≠sica/procedimental y limpieza evitan trazas accidentales."},
{"q":"Pescado listo para consumo en c√°mara junto a carne cruda destapada:","options":["Aceptar si hay rejilla.","Inaceptable: riesgo de goteo/olores y contaminaci√≥n cruzada.","Da igual si se consume hoy."],"correctIndex":1,"rationale":"Los listos para consumo deben estar alejados de crudos y siempre protegidos."},
{"q":"Higienizaci√≥n de cortadoras de fiambre:","options":["Diaria al final del turno.","Tras cada cambio de producto y, como m√≠nimo, varias veces al d√≠a seg√∫n uso; desmontar piezas.","Solo pasar un pa√±o h√∫medo."],"correctIndex":1,"rationale":"Desmontaje y desinfecci√≥n peri√≥dica previene biofilms."},
{"q":"Huevos pasteurizados vs. frescos en elaboraciones crudas (mahonesa):","options":["Ambos equivalentes.","Preferir pasteurizados para evitar Salmonella.","Usar frescos si est√°n fr√≠os."],"correctIndex":1,"rationale":"Los pasteurizados reducen riesgo en salsas/cremas no sometidas a calor."},
{"q":"Cuchillos con mango da√±ado:","options":["Pueden usarse si se desinfectan.","Reemplazar; pueden albergar suciedad y desprender fragmentos.","Cubrir con cinta."],"correctIndex":1,"rationale":"Riesgo f√≠sico y microbiol√≥gico por grietas y desprendimientos."},
{"q":"Carnes marinadas para consumir poco hechas:","options":["El marinado elimina pat√≥genos.","El marinado no sustituye la cocci√≥n a temperatura segura.","Se pueden dejar a temperatura ambiente."],"correctIndex":1,"rationale":"Los √°cidos reducen carga pero no garantizan inocuidad; cocinar adecuadamente."},
{"q":"Desinfectantes alimentarios:","options":["Usar cualquiera de uso dom√©stico.","Usar productos autorizados, respetando concentraci√≥n y tiempo de contacto.","Cuanto m√°s concentrado mejor."],"correctIndex":1,"rationale":"Seguir etiqueta garantiza eficacia sin residuos peligrosos."},
{"q":"Recepci√≥n de pescado fresco:","options":["Olor fuerte a amon√≠aco es normal.","Ojos brillantes, agallas rojas y olor marino suave.","Puede venir parcialmente descongelado sin indicarlo."],"correctIndex":1,"rationale":"Los signos organol√©pticos indican frescura; la descongelaci√≥n debe declararse."},
{"q":"Cocci√≥n de aves (aves enteras y piezas):","options":["60 ¬∞C en centro es suficiente.","‚â•74‚Äì75 ¬∞C en el centro del producto.","Depende del color del jugo."],"correctIndex":1,"rationale":"Las aves requieren temperaturas internas m√°s altas por riesgo de Salmonella/Campylobacter."},
{"q":"Descongelaci√≥n en agua:","options":["Permitida sumergiendo en agua potable fr√≠a y protegida, cambiando agua; cocinar inmediatamente.","Siempre prohibida.","En agua caliente para acelerar."],"correctIndex":0,"rationale":"La t√©cnica puede usarse con control estricto y cocci√≥n inmediata."},
{"q":"Productos qu√≠micos de limpieza:","options":["Pueden almacenarse junto a alimentos si est√°n cerrados.","Separar en armario espec√≠fico se√±alizado; nunca sobre alimentos.","Dejar envases sin etiqueta si se reconoce el contenido."],"correctIndex":1,"rationale":"Evita contaminaci√≥n qu√≠mica y confusiones; etiquetado obligatorio."},
{"q":"Deshuesado de jam√≥n/queso en sala fr√≠a y corte en caliente:","options":["Admisible sin limpieza intermedia.","Requiere limpieza/desinfecci√≥n y separaci√≥n de zonas/equipos o tiempos.","No necesita control."],"correctIndex":1,"rationale":"Evita transporte de microorganismos entre zonas con distinta temperatura y riesgo."},
{"q":"Uso de term√≥metros sonda:","options":["No es necesario si hay experiencia.","Calibrar, limpiar y desinfectar la sonda antes/despu√©s; medir en el centro.","Solo mirar el color del alimento."],"correctIndex":1,"rationale":"La medici√≥n objetiva asegura temperaturas de seguridad."},
{"q":"Gesti√≥n de devoluciones/retiros por alerta alimentaria:","options":["No procede en hosteler√≠a.","Tener procedimiento de trazabilidad inversa para localizar lotes y retirarlos.","Informar solo si lo piden."],"correctIndex":1,"rationale":"Permite actuar con rapidez ante alertas para proteger a los clientes."},
{"q":"Carne picada elaborada en local:","options":["Se puede guardar 48 h en fr√≠o.","Consumir cuanto antes; si se conserva, ‚â§24 h a ‚â§4 ¬∞C y perfectamente identificada.","Se puede mantener a 8‚Äì10 ¬∞C."],"correctIndex":1,"rationale":"Producto muy perecedero por su elevada superficie y manipulaci√≥n."}
]}
};

/* ===== L√ìGICA ===== */
const $ = s => document.querySelector(s);
let st={block:"1",idx:0,score:0,answers:[],ok:0,bad:0,total:0};

function showStart(){
  $("#home").style.display="block";
  $("#quiz").style.display="none";
  $("#end").style.display="none";
  $("#topStatus").textContent = "En portada";
  window.scrollTo(0,0);
}

function startBlock(n){
  const b=BLOCKS[n];
  st={block:n,idx:0,score:0,answers:[],ok:0,bad:0,total:b.questions.length};
  $("#home").style.display="none";
  $("#end").style.display="none";
  $("#quiz").style.display="block";
  $("#head").textContent="Bloque "+b.id+" ¬∑ "+b.level;
  $("#statOk").textContent=0; $("#statBad").textContent=0;
  $("#statQ").textContent=0; $("#statTotal").textContent=b.questions.length;
  $("#bar").style.width="0%";
  $("#topStatus").textContent = "Bloque "+b.id+" ¬∑ "+b.level+" ‚Äî 0/"+b.questions.length+" ¬∑ ‚úÖ0 ¬∑ ‚ùå0";
  renderQuestion();
  window.scrollTo(0,0);
}

function renderQuestion(){
  const b=BLOCKS[st.block];
  if(st.idx>=b.questions.length){ return endBlock(); }
  const q=b.questions[st.idx];
  $("#qtitle").textContent="P"+(st.idx+1)+". "+q.q;
  $("#choices").innerHTML=""; $("#explain").style.display="none"; $("#explain").innerHTML="";
  $("#next").disabled=true;
  q.options.forEach((t,i)=>{
    const d=document.createElement("div");
    d.className="choice"; d.textContent=t;
    d.onclick=function(){ select(i); };
    $("#choices").appendChild(d);
  });
  $("#statQ").textContent=st.idx+1;
  $("#progressText").textContent=(st.idx+1)+"/"+b.questions.length;
  const pct=Math.round(100*(st.idx)/b.questions.length);
  $("#bar").style.width=pct+"%";
  $("#topStatus").textContent = "Bloque "+b.id+" ¬∑ "+b.level+" ‚Äî "+(st.idx)+"/"+b.questions.length+" ¬∑ ‚úÖ"+st.ok+" ¬∑ ‚ùå"+st.bad;
}

$("#next").onclick=function(){ st.idx++; renderQuestion(); };

function select(i){
  const b=BLOCKS[st.block], q=b.questions[st.idx];
  const nodes=[...$("#choices").children];
  nodes.forEach((n,ix)=>{ if(ix===q.correctIndex) n.classList.add("correct");
                          if(ix===i && i!==q.correctIndex) n.classList.add("incorrect");
                          n.onclick=null; });
  const ok=(i===q.correctIndex); if(ok){ st.score++; st.ok++; } else { st.bad++; }
  st.answers.push({q:q.q,selected:q.options[i],correct:q.options[q.correctIndex],ok,rationale:q.rationale});
  $("#explain").style.display="block";
  $("#explain").innerHTML="<b>Correcta:</b> "+q.options[q.correctIndex]+"<div style='margin-top:6px'>"+q.rationale+"</div>";
  $("#next").disabled=false;

  $("#statOk").textContent=st.ok; $("#statBad").textContent=st.bad;
  const btot=b.questions.length;
  $("#topStatus").textContent = "Bloque "+b.id+" ¬∑ "+b.level+" ‚Äî "+(st.idx+1)+"/"+btot+" ¬∑ ‚úÖ"+st.ok+" ¬∑ ‚ùå"+st.bad;
  const pct=Math.round(100*(st.idx+1)/btot); $("#bar").style.width=pct+"%";
}

function endBlock(){
  $("#quiz").style.display="none"; $("#end").style.display="block"; window.scrollTo(0,0);
  const b=BLOCKS[st.block]; const pct=Math.round(100*st.score/b.questions.length);
  $("#score").textContent="Aciertos: "+st.score+"/"+b.questions.length+" ¬∑ "+pct+"%";
  const wrong=st.answers.filter(a=>!a.ok);
  $("#review").innerHTML = wrong.length ? wrong.map(a=>(
    "<div style='border-left:4px solid var(--bad); padding-left:10px; margin:10px 0'>"+
    "<div><b>"+a.q+"</b></div>"+
    "<div>Tu respuesta: "+a.selected+" ‚ùå</div>"+
    "<div>Correcta: "+a.correct+" ‚úÖ</div>"+
    "<div style='color:#475569'>"+a.rationale+"</div></div>"
  )).join("") : "<p>üéâ Sin fallos en este bloque.</p>";

  const text=wrong.map(a=>(a.q+" "+a.rationale).toLowerCase()).join(" ");
  const tips=[]; if(/temperat|fr[i√≠]o|caliente|70|75|65/.test(text)) tips.push("Control de temperaturas (0‚Äì4 ¬∞C, ‚â•65 ¬∞C, ‚â•70‚Äì75 ¬∞C).");
  if(/descongel/.test(text)) tips.push("Descongelaci√≥n segura (nevera/microondas) y cocci√≥n inmediata.");
  if(/al[e√©]rgen|traz/.test(text)) tips.push("Gesti√≥n de al√©rgenos y trazabilidad documentada.");
  if(/limpieza|desinfect/.test(text)) tips.push("Limpieza antes de desinfectar, respetando tiempos.");
  $("#recommendation").textContent="Recomendaci√≥n: "+(tips.length?tips.join(" "):"Buen desempe√±o; repite para consolidar.");

  saveScore(pct, b.id, st.score, b.questions.length, wrong);
  $("#topStatus").textContent = "Bloque "+b.id+" finalizado ‚Äî ‚úÖ"+st.ok+" ¬∑ ‚ùå"+st.bad+" ("+pct+"%)";
}

/* ===== Ranking (sin borrar) ===== */
function getReg(){ try{return JSON.parse(localStorage.getItem("rankingFull")||"[]");}catch(e){return[];} }
function setReg(r){ localStorage.setItem("rankingFull", JSON.stringify(r)); }

function saveScore(pct, block, score, total, wrong){
  const name=(prompt("Tu nombre para el ranking (opcional):","")||"").trim()||"an√≥nimo";
  const r=getReg(); r.push({name,pct,block,score,total,date:new Date().toISOString()});
  r.sort((a,b)=>b.pct-a.pct || (a.date<b.date?1:-1)); setReg(r);
  if(ENDPOINT_URL){
    try{ fetch(ENDPOINT_URL,{method:"POST",headers:{"Content-Type":"application/json"},
      body:JSON.stringify({name,pct,block,score,total,wrong})}); }catch(e){}
  }
}
function openRanking(){
  const r=getReg();
  document.getElementById("rankList").innerHTML = r.length? r.slice(0,30).map((x,i)=>
    (i+1)+". <b>"+escapeHtml(x.name)+"</b> ‚Äî "+x.pct+"% (Bloque "+x.block+") ¬∑ "+new Date(x.date).toLocaleString()
  ).join("<br>") : "A√∫n no hay puntuaciones.";
  document.getElementById("rankModal").classList.add("show");
}
function closeRanking(){ document.getElementById("rankModal").classList.remove("show"); }
function escapeHtml(s){return s.replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));}

/* Inicio */
showStart();
</script>
</body>
</html>
